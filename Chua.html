<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lucky Orbs — Cosmetics & Skins</title>
  <meta name="description" content="Advanced RNG game with cosmetic orb skins, animated visuals, responsive layout, themes, shop with images, and improved UX." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#071029; --card:#071827; --accent:#7c3aed; --accent-2:#06b6d4; --glass:rgba(255,255,255,0.04);
      --muted:rgba(255,255,255,0.66); --success:#10b981; --danger:#ef4444; --glass-2:rgba(255,255,255,0.02);
      --text:#e6eef8; --radius:14px; --max-width:1200px; --orb-size:220px;
      font-family:Inter, Poppins, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    [data-theme='dark']{ --bg:#071029; --card:#071827; --accent:#7c3aed; --accent-2:#06b6d4; --text:#e6eef8 }
    [data-theme='midnight']{ --bg:#00121b; --card:#07132a; --accent:#06b6d4; --accent-2:#7c3aed; --text:#eaf6ff }
    [data-theme='sunrise']{ --bg:#fff7ed; --card:#fff; --accent:#fb923c; --accent-2:#ef4444; --text:#0b1020 }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,var(--bg) 0%, #03121a 100%);color:var(--text);display:flex;align-items:flex-start;justify-content:center;padding:24px}

    .app{width:100%;max-width:var(--max-width)}
    header{display:flex;gap:12px;align-items:center;margin-bottom:14px}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .layout{display:grid;grid-template-columns:320px 1fr 360px;gap:16px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);border:1px solid rgba(255,255,255,0.04);padding:16px;border-radius:var(--radius);box-shadow:0 10px 40px rgba(2,6,23,0.6)}

    .left .profile{display:flex;align-items:center;gap:12px}
    .avatar{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#0ea5a4,#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:800}

    .orb-wrap{display:flex;flex-direction:column;align-items:center;gap:14px}
    .orb{width:var(--orb-size);height:var(--orb-size);border-radius:50%;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;background:radial-gradient(circle at 30% 25%, rgba(255,255,255,0.03), transparent 10%);box-shadow:0 30px 80px rgba(2,6,23,0.6)}
    .orb .skin{position:absolute;inset:0;background-size:cover;background-position:center;transform-origin:center;transition:transform 600ms cubic-bezier(.2,.9,.2,1)}
    .orb .overlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.08), rgba(0,0,0,0.18))}
    .orb .center{position:relative;z-index:5;text-align:center}

    .value{font-size:44px;font-weight:800;letter-spacing:1px}
    .rarity{font-weight:800;font-size:13px;padding:6px 12px;border-radius:999px;display:inline-block;margin-top:8px}

    .controls{display:flex;gap:10px;align-items:center}
    .btn{appearance:none;border:0;padding:10px 14px;border-radius:10px;font-weight:800;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;box-shadow:0 14px 36px rgba(124,58,237,0.14)}
    .btn-ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)}

    .shop-item{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
    .skin-thumb{width:64px;height:64px;border-radius:10px;overflow:hidden;flex-shrink:0;border:1px solid rgba(255,255,255,0.03)}
    .skin-meta{flex:1}

    .theme-switcher{display:flex;gap:8px;align-items:center}
    .theme-dot{width:14px;height:14px;border-radius:999px;cursor:pointer;border:1px solid rgba(255,255,255,0.06)}

    .log{height:240px;overflow:auto;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:12px;border-radius:10px;font-family:monospace;font-size:13px}

    .skin-list{display:grid;grid-template-columns:1fr;gap:8px;margin-top:8px}
    .skin-actions{display:flex;gap:8px;align-items:center}

    .badge{background:var(--glass);padding:6px 8px;border-radius:8px;font-weight:700}

    /* responsive */
    @media (max-width:1100px){.layout{grid-template-columns:1fr;}.orb{--orb-size:180px}}

    /* animations */
    .orb.spin .skin{animation:orbSpin 2.6s cubic-bezier(.2,.9,.2,1)}
    @keyframes orbSpin{0%{transform:rotate(0) scale(1)}50%{transform:rotate(180deg) scale(1.03)}100%{transform:rotate(360deg) scale(1)}}

    .glow{box-shadow:0 0 40px rgba(124,58,237,0.22), inset 0 8px 40px rgba(124,58,237,0.06)}

    /* skin preview styles */
    .skin-animated-1{background:conic-gradient(from 120deg at 50% 50%, rgba(124,58,237,0.12), rgba(6,182,212,0.12), rgba(124,58,237,0.12)); animation:flow 6s linear infinite}
    .skin-animated-2{background:linear-gradient(120deg,#ff7a18,#af002d 40%, #3a1c71 100%); animation:flow 10s linear infinite}
    @keyframes flow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

  </style>
</head>
<body data-theme="dark">
  <div class="app">
    <header>
      <div>
        <h1>Lucky Orbs — Skins & Cosmetics</h1>
        <p class="lead">New: cosmetics shop with animated orb skins, upload your own images, theme switcher, responsive layout and polished animations.</p>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <div class="theme-switcher">
          <div title="Dark" class="theme-dot" style="background:linear-gradient(135deg,#0f1724,#0b1220)" data-theme="dark"></div>
          <div title="Midnight" class="theme-dot" style="background:linear-gradient(135deg,#00121b,#07132a)" data-theme="midnight"></div>
          <div title="Sunrise" class="theme-dot" style="background:linear-gradient(135deg,#fff7ed,#ffedd5)" data-theme="sunrise"></div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="exportBtn" class="btn btn-ghost">Export</button>
          <button id="importBtn" class="btn btn-ghost">Import</button>
        </div>
      </div>
    </header>

    <div class="layout">
      <!-- LEFT -->
      <aside class="card left">
        <div class="profile">
          <div class="avatar" id="playerAvatar">U</div>
          <div>
            <div style="font-weight:800" id="playerName">You</div>
            <div class="muted">Balance: ₱<span id="balance">0</span></div>
          </div>
        </div>

        <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0;border-radius:2px">

        <div>
          <div class="muted">Achievements</div>
          <div class="skin-list" id="achGrid"></div>
        </div>

        <div style="margin-top:12px">
          <div class="muted">Upload Custom Skin</div>
          <input id="uploadSkin" type="file" accept="image/*" />
          <div style="margin-top:8px;font-size:13px" class="muted">Upload an image to create a custom orb skin. It will be added to your cosmetics.</div>
        </div>

      </aside>

      <!-- CENTER -->
      <main class="card center">
        <div class="orb-wrap">
          <div class="orb" id="orb">
            <div class="skin" id="orbSkin"></div>
            <div class="overlay"></div>
            <div class="center">
              <div class="value" id="value">—</div>
              <div id="rarityBadge" class="rarity rar-common">—</div>
            </div>
          </div>

          <div class="controls">
            <button id="rollBtn" class="btn btn-primary">ROLL (₱<span id="rollCostDisplay">5</span>)</button>
            <button id="multiBtn" class="btn btn-ghost">×10</button>
            <button id="autoBtn" class="btn btn-ghost">Auto</button>
            <select id="skinPicker" style="padding:8px;border-radius:8px;background:transparent;color:inherit;border:1px solid rgba(255,255,255,0.04)">
            </select>
          </div>

          <div style="display:flex;gap:12px;justify-content:space-between;width:100%;margin-top:10px">
            <div class="muted">Last Win: <span id="lastWin">—</span></div>
            <div class="muted">Seed: <span id="seedShort">—</span></div>
          </div>

          <div style="width:100%;margin-top:12px">
            <div class="muted">Activity Log</div>
            <div class="log" id="log"></div>
          </div>
        </div>
      </main>

      <!-- RIGHT -->
      <aside class="card right">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div class="muted">Cosmetic Shop</div>
          <div class="muted">Owned: <span id="ownedCount">0</span></div>
        </div>

        <div id="shopList"></div>

        <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0;border-radius:2px">

        <div>
          <div class="muted">Leaderboard (Local)</div>
          <div id="leaderboard" style="margin-top:8px"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="nameInput" placeholder="Your name" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
            <button id="submitScore" class="btn btn-primary">Submit</button>
          </div>
        </div>

      </aside>
    </div>
  </div>

  <canvas id="confetti" style="position:fixed;inset:0;pointer-events:none;opacity:0;transition:opacity 300ms"></canvas>

  <script>
  (function(){
    // Elements
    const body = document.body
    const balanceEl = document.getElementById('balance')
    const valueEl = document.getElementById('value')
    const rarityEl = document.getElementById('rarityBadge')
    const orbEl = document.getElementById('orb')
    const orbSkin = document.getElementById('orbSkin')
    const rollBtn = document.getElementById('rollBtn')
    const multiBtn = document.getElementById('multiBtn')
    const autoBtn = document.getElementById('autoBtn')
    const skinPicker = document.getElementById('skinPicker')
    const shopList = document.getElementById('shopList')
    const logEl = document.getElementById('log')
    const seedShort = document.getElementById('seedShort')
    const ownedCountEl = document.getElementById('ownedCount')
    const uploadSkin = document.getElementById('uploadSkin')

    // canvas confetti
    const confettiCanvas = document.getElementById('confetti')
    const ctx = confettiCanvas.getContext('2d')
    let confettiPieces = []
    function resizeCanvas(){ confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight }
    window.addEventListener('resize', resizeCanvas); resizeCanvas()

    // storage
    const KEY = 'lucky-orbs-cosmetics-v1'
    const LB_KEY = 'lucky-orbs-leaderboard-v1'

    const defaultState = {
      balance: 200,
      high: 0,
      rolls: 0,
      bestStreak: 0,
      curStreak: 0,
      lastWin: '—',
      seed: (new Date().getTime() + Math.floor(Math.random()*1e9)).toString(36).slice(0,8).toUpperCase(),
      wins:0, rare:0, epic:0, legend:0,
      skins: [], // owned skins
      activeSkin: 'classic',
      auto:false,
      rollCost:5
    }

    let state = {}

    // pre-defined cosmetic skins (thumbnails are represented via background CSS or inline SVG data URLs)
    const builtInSkins = [
      {id:'classic', title:'Classic Orb', price:0, thumb:genThumbClassic(), cssClass:''},
      {id:'aurora', title:'Aurora Flow', price:120, thumb:genThumbGradient('#7c3aed','#06b6d4'), cssClass:'skin-animated-1'},
      {id:'sunburst', title:'Sunburst', price:140, thumb:genThumbGradient('#ff7a18','#3a1c71'), cssClass:'skin-animated-2'},
      {id:'galaxy', title:'Galaxy', price:300, thumb:genThumbImage('data:image/svg+xml;utf8,'+encodeURIComponent(svgGalaxy())), cssClass:''},
    ]

    // helpers to generate small svg/image thumbnails for shop
    function genThumbGradient(a,b){ return `linear-gradient(135deg, ${a}, ${b})` }
    function genThumbClassic(){ return `linear-gradient(135deg,#0ea5a4,#7c3aed)` }
    function genThumbImage(url){ return `url(${url})` }

    function svgGalaxy(){
      return `<?xml version=\"1.0\" encoding=\"utf-8\"?><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 200 200\"><defs><radialGradient id=\"g\"><stop offset=\"0%\" stop-color=\"#fff\" stop-opacity=\"0.95\"/><stop offset=\"40%\" stop-color=\"#7c3aed\" stop-opacity=\"0.7\"/><stop offset=\"100%\" stop-color=\"#0f1724\"/></radialGradient></defs><rect width=\"100%\" height=\"100%\" fill=\"url(#g)\"/><g fill=\"#fff\" opacity=\"0.9\"><circle cx=\"40\" cy=\"40\" r=\"2\"/><circle cx=\"140\" cy=\"60\" r=\"1.5\"/><circle cx=\"80\" cy=\"110\" r=\"1.3\"/></g></svg>`
    }

    // load/save
    function load(){ try{ const saved = JSON.parse(localStorage.getItem(KEY)); state = saved ? {...defaultState,...saved} : {...defaultState}; }catch(e){ state = {...defaultState} } }
    function save(){ localStorage.setItem(KEY, JSON.stringify(state)) }

    // initialize built-in skins into player's catalog if not present
    function ensureBuiltInSkins(){ builtInSkins.forEach(s=>{ if(!state.skins.find(x=>x.id===s.id)){ state.skins.push({...s,owned: s.price===0, ownedAt: s.price===0?Date.now():null}) } }) }

    // rendering shop
    function renderShop(){ shopList.innerHTML = ''; builtInSkins.forEach(s=>{ const item = state.skins.find(x=>x.id===s.id); const div = document.createElement('div'); div.className='shop-item'; div.innerHTML = `<div class="skin-thumb" style="background:${s.thumb}"></div><div class="skin-meta"><div style='font-weight:800'>${s.title}</div><div class='muted' style='font-size:12px'>${s.price===0?'Free':`₱${s.price}`}</div></div><div class='skin-actions'><button class='btn buy' data-id='${s.id}'>${item && item.owned ? 'Select' : 'Buy'}</button></div>`; shopList.appendChild(div) });
      // attach handlers
      shopList.querySelectorAll('.buy').forEach(b=> b.addEventListener('click', ()=>{ const id=b.dataset.id; handleBuyOrSelect(id) }))
      updateOwnedCount()
    }

    function updateOwnedCount(){ ownedCountEl.textContent = state.skins.filter(s=>s.owned).length }

    function handleBuyOrSelect(id){ const s = state.skins.find(x=>x.id===id); if(!s) return; if(s.owned){ setActiveSkin(id); pushLog(`Selected skin: ${s.title}`); return } // buy
      const skinDef = builtInSkins.find(x=>x.id===id); if(!skinDef) return; if(state.balance < skinDef.price){ pushLog('Not enough coins to buy skin', 'warn'); return } state.balance -= skinDef.price; s.owned = true; s.ownedAt = Date.now(); save(); renderShop(); updateUI(); pushLog(`Purchased skin: ${skinDef.title} — ₱${skinDef.price}`) }

    function setActiveSkin(id){ const s = state.skins.find(x=>x.id===id); if(!s || !s.owned) return; state.activeSkin = id; applySkin(s); save(); updateUI(); populateSkinPicker() }

    function applySkin(skin){ // skin may have cssClass or background
      // reset classes
      orbSkin.className = 'skin'
      if(skin.cssClass) orbSkin.classList.add(skin.cssClass)
      // If skin has custom image url, set as background
      if(skin.customDataURL){ orbSkin.style.background = `url(${skin.customDataURL}) center/cover no-repeat` }
      else if(skin.cssClass){ orbSkin.style.background = '' }
      else if(skin.thumb && skin.thumb.startsWith('linear-gradient')){ orbSkin.style.background = skin.thumb }
      else if(skin.thumb && skin.thumb.startsWith('url(')){ orbSkin.style.background = skin.thumb }
    }

    // populate skin picker
    function populateSkinPicker(){ skinPicker.innerHTML = ''; state.skins.forEach(s=>{ const opt = document.createElement('option'); opt.value = s.id; opt.textContent = `${s.title}${s.owned ? ' (Owned)' : ''}`; skinPicker.appendChild(opt) }); skinPicker.value = state.activeSkin }
    skinPicker.addEventListener('change', ()=>{ setActiveSkin(skinPicker.value) })

    // user upload skin
    uploadSkin.addEventListener('change', (e)=>{ const f = e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = ()=>{ const dataURL = reader.result; // add to state.skins as custom skin
        const id = 'custom-'+Date.now().toString(36); const title = f.name.split('.').slice(0,-1).join('.') || 'Custom Skin'; state.skins.push({id,title,price:0,thumb:`url(${dataURL})`,cssClass:'',customDataURL:dataURL,owned:true,ownedAt:Date.now()}); save(); renderShop(); populateSkinPicker(); pushLog(`Custom skin added: ${title}`) }; reader.readAsDataURL(f) })

    // RNG and roll logic
    function rng(){ const s = state.seed.split('').reduce((a,c)=>a + c.charCodeAt(0), 0); const t = performance.now(); const x = Math.sin(t*0.000021 + s) * 10000; return x - Math.floor(x) }

    function rollOnce(){ if(state.balance < state.rollCost){ pushLog('Not enough coins to roll', 'warn'); return } state.balance -= state.rollCost; state.rolls += 1; const r = Math.floor(rng()*100)+1; valueEl.textContent = r; let rarity='Common', cls='rar-common', points=1; if(r >= 100){ rarity='Mythic'; cls='rar-legend'; points=300 } else if(r >= 96){ rarity='Legendary'; cls='rar-legend'; points=80 } else if(r >= 85){ rarity='Epic'; cls='rar-epic'; points=25 } else if(r >= 60){ rarity='Rare'; cls='rar-rare'; points=8 } else { rarity='Common'; cls='rar-common'; points=1 }
      state.balance += points
      if(['Rare','Epic','Legendary','Mythic'].includes(rarity)){ state.curStreak += 1; state.bestStreak = Math.max(state.bestStreak, state.curStreak); state.lastWin = `${rarity} (+${points})`; state.wins += 1 } else { state.curStreak = 0 }
      if(rarity==='Legendary' || rarity==='Mythic') fireConfetti(rarity==='Mythic'?150:90)
      // quick orb spin animation
      orbEl.classList.add('spin'); setTimeout(()=>orbEl.classList.remove('spin'), 2600);
      pushLog(`#${state.rolls} rolled ${r} — ${rarity} (+${points})`, rarity)
      updateUI(); save(); return {r,rarity,points}
    }

    // UI updates
    function updateUI(){ balanceEl.textContent = state.balance; seedShort.textContent = state.seed.slice(0,6); document.getElementById('lastWin').textContent = state.lastWin; document.getElementById('rollCostDisplay').textContent = state.rollCost }

    // logging
    function pushLog(txt, kind){ const node=document.createElement('div'); node.textContent=txt; node.style.padding='6px 0'; if(kind==='Legendary'||kind==='Mythic') node.style.fontWeight='900'; logEl.prepend(node); while(logEl.childNodes.length>300) logEl.removeChild(logEl.lastChild) }

    // confetti engine (same as before but smaller)
    function createPiece(){ return { x: Math.random()*confettiCanvas.width, y:-20-Math.random()*200, vx:(Math.random()-0.5)*6, vy:2+Math.random()*5, size:6+Math.random()*10, rot:Math.random()*360, velRot:(Math.random()-0.5)*12, color:['#f59e0b','#ef4444','#10b981','#7c3aed','#06b6d4'][Math.floor(Math.random()*5)] } }
    function fireConfetti(count=60){ confettiCanvas.style.opacity=1; for(let i=0;i<count;i++) confettiPieces.push(createPiece()); if(!window._confettiLoop) loopConfetti(); setTimeout(()=>confettiCanvas.style.opacity=0,2200) }
    function loopConfetti(){ window._confettiLoop=true; const step=()=>{ ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); confettiPieces = confettiPieces.filter(p=>p.y < confettiCanvas.height + 50); confettiPieces.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.vy += 0.08; p.rot += p.velRot; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180); ctx.fillStyle=p.color; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6); ctx.restore() }); if(confettiPieces.length) requestAnimationFrame(step); else window._confettiLoop=false }; requestAnimationFrame(step) }

    // leaderboard
    function loadLeaderboard(){ try{ return JSON.parse(localStorage.getItem(LB_KEY)) || [] }catch(e){ return [] } }
    function renderLeaderboard(){ const lb = loadLeaderboard().slice(0,10); const el = document.getElementById('leaderboard'); el.innerHTML=''; lb.forEach((r,idx)=>{ const d=document.createElement('div'); d.style.padding='8px'; d.style.borderRadius='8px'; d.style.background='linear-gradient(180deg, rgba(255,255,255,0.01), transparent)'; d.style.display='flex'; d.style.justifyContent='space-between'; d.innerHTML = `<div style='font-weight:800'>${idx+1}. ${escapeHtml(r.name)}</div><div class='muted'>${r.score} pts</div>`; el.appendChild(d) }) }
    function submitLeaderboard(){ const name = (document.getElementById('nameInput').value || 'Player').slice(0,24); const score = state.high; const lb = loadLeaderboard(); lb.push({name,score,date:Date.now()}); lb.sort((a,b)=>b.score-a.score); localStorage.setItem(LB_KEY, JSON.stringify(lb.slice(0,100))); renderLeaderboard(); pushLog('Score submitted to local leaderboard') }

    // helper
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]) }

    // theme switcher
    document.querySelectorAll('.theme-dot').forEach(d=> d.addEventListener('click', ()=>{ const t = d.dataset.theme; body.setAttribute('data-theme', t) }))

    // export/import
    document.getElementById('exportBtn').addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify(state)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download='lucky-orbs-save.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url) })
    document.getElementById('importBtn').addEventListener('click', ()=>{ const inp=document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange = ()=>{ const f = inp.files[0]; if(!f) return; const r = new FileReader(); r.onload = ()=>{ try{ const imported = JSON.parse(r.result); state = {...defaultState,...imported}; ensureBuiltInSkins(); save(); renderAll(); pushLog('Save imported') }catch(e){ pushLog('Failed to import save', 'warn') } }; r.readAsText(f) }; inp.click() })

    // event handlers
    rollBtn.addEventListener('click', ()=> rollOnce())
    multiBtn.addEventListener('click', ()=>{ for(let i=0;i<10;i++) rollOnce() })
    autoBtn.addEventListener('click', ()=>{ state.auto = !state.auto; autoBtn.textContent = state.auto ? 'Auto ✓' : 'Auto'; if(state.auto) startAuto(); else stopAuto(); save() })
    document.getElementById('submitScore').addEventListener('click', submitLeaderboard)

    // auto roll
    let autoTimer = null
    function startAuto(){ if(autoTimer) clearInterval(autoTimer); autoTimer = setInterval(()=>{ if(document.hidden) return; rollOnce() }, 1000) }
    function stopAuto(){ if(autoTimer){ clearInterval(autoTimer); autoTimer=null } }

    // ensure skins
    function initSkins(){ ensureBuiltInSkins(); renderShop(); populateSkinPicker(); const active = state.skins.find(s=>s.id===state.activeSkin) || state.skins[0]; setActiveSkin(active.id) }

    // render shop
    function renderShop(){ // uses state.skins; handled above by renderShop() function name collision, so ensure not recursive
      shopList.innerHTML = '';
      state.skins.forEach(s=>{
        const def = builtInSkins.find(b=>b.id===s.id) || {};
        const title = s.title || def.title || 'Custom Skin';
        const price = def.price !== undefined ? def.price : (s.price||0);
        const thumb = s.customDataURL ? `url(${s.customDataURL})` : (def ? def.thumb : s.thumb || genThumbClassic())
        const owned = s.owned === true;
        const div = document.createElement('div'); div.className='shop-item'; div.innerHTML = `<div class='skin-thumb' style='background:${thumb}'></div><div class='skin-meta'><div style='font-weight:800'>${title}</div><div class='muted' style='font-size:12px'>${price===0?'Free':`₱${price}`}</div></div><div class='skin-actions'><button class='btn buy' data-id='${s.id}'>${owned ? 'Select' : 'Buy'}</button></div>`; shopList.appendChild(div)
      })
      shopList.querySelectorAll('.buy').forEach(b=> b.addEventListener('click', ()=> { handleBuyOrSelect(b.dataset.id) }))
      updateOwnedCount()
    }

    // re-export a non-recursive name
    function renderShopList(){ renderShop() }

    // initial load
    load(); ensureBuiltInSkins(); initSkins(); renderLeaderboard(); updateUI(); pushLog(`Welcome! Starter balance ₱${state.balance}. Seed: ${state.seed}`)

    // expose for debugging
    window._luckyOrbs = {state, save, load}

  })();
  </script>
</body>
</html>
